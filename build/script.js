!function(){"use strict";var e=window.wp.element;const{createHigherOrderComponent:t}=wp.compose,{Fragment:a,useEffect:l,useState:o}=wp.element,{InspectorControls:n}=wp.blockEditor,{PanelBody:r,ToggleControl:c,PanelRow:s,TextControl:u,SelectControl:d}=wp.components,{union:m}=lodash;wp.hooks.addFilter("blocks.registerBlockType","query-block-extension/metadata/sort/add-attributes",(function(e,t){return"core/query"!==t?e:{...e,attributes:{...e.attributes,metaSortEnabled:{type:"boolean",default:!1}}}}));const i=t((t=>s=>{const{name:u,attributes:m,setAttributes:i}=s,{metaSortEnabled:b,query:y}=m,[p,E]=o([]);if("core/query"!==u)return(0,e.createElement)(t,s);l((()=>{(async()=>{const e=new FormData;e.append("action","metadata_sort_get_meta_keys"),e.append("nonce",wp_query_block_metadata_sort.nonce);const t=await fetch(ajaxurl,{method:"POST",credentials:"same-origin",body:e}),a=await t.json();a.success&&E(a.data)})()}),[]);const v=()=>{const{metaKey:e,...t}=y;i({metaSortEnabled:!1,query:{...t,orderBy:"date",order:"desc"}})};return l((()=>{!y.orderBy.startsWith("meta_value")&&b&&v()}),[y.orderBy]),(0,e.createElement)(a,null,(0,e.createElement)(t,s),(0,e.createElement)(n,null,(0,e.createElement)(r,{title:"Metadata Sort",initialOpen:!1},p.length>0?(0,e.createElement)(a,null,(0,e.createElement)(c,{label:"Enable Metadata Sort",checked:b,onChange:e=>{e?i({metaSortEnabled:!0,query:{...y,orderBy:"meta_value",order:"desc",metaKey:p[0]}}):v()}}),b?(0,e.createElement)(a,null,(0,e.createElement)(d,{label:"Meta Type",value:y.metaType?y.metaType:"CHAR",options:[{label:"Char",value:"CHAR"},{label:"Numeric",value:"NUMERIC"},{label:"Binary",value:"BINARY"},{label:"Date",value:"DATE"},{label:"DateTime",value:"DATETIME"},{label:"Decimal",value:"DECIMAL"},{label:"Signed",value:"SIGNED"},{label:"Time",value:"TIME"},{label:"Unsigned",value:"UNSIGNED"}],onChange:e=>{i({query:{...y,metaType:e}})}}),(0,e.createElement)(d,{label:"Order",value:y.order,options:[{label:"DESC",value:"desc"},{label:"ASC",value:"asc"}],onChange:e=>{i({query:{...y,order:e}})}}),(0,e.createElement)(d,{label:"Meta Key",value:y.metaKey,options:p.map((e=>({label:e,value:e}))),onChange:e=>{i({query:{...y,metaKey:e}})},__nextHasNoMarginBottom:!0})):null):(0,e.createElement)("p",null,"No post meta key detected on your site"))))}),"withInspectorControl");wp.hooks.addFilter("editor.BlockEdit","query-block-extension/metadata/sort/add-controls",i)}();